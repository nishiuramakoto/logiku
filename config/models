------------------ Prolog Program Database Schema -------------------------------
-- TODO: Add modification times

-- 'user' is a reserved name in postgres...
UserAccount
    ident       Text
    privileged  Bool
    password    Text Maybe
    displayName Text Maybe
    created     UTCTime default=CURRENT_TIMESTAMP

    umaskOwnerR    Bool
    umaskOwnerW    Bool
    umaskOwnerX    Bool
    umaskGroupR    Bool
    umaskGroupW    Bool
    umaskGroupX    Bool
    umaskEveryoneR Bool
    umaskEveryoneW Bool
    umaskEveryoneX Bool

    UniqueUserAccount ident
    deriving Show Typeable


Directory json
      userId        UserAccountId
      name          Text
      code          Text
      explanation   Text
      created       UTCTime default=CURRENT_TIMESTAMP


      ownerR    Bool
      ownerW    Bool
      ownerX    Bool
      everyoneR Bool
      everyoneW Bool
      everyoneX Bool

      UniqueDirectory userId name
      deriving  Show

File
      userId          UserAccountId
      directoryId     DirectoryId
      name            Text
      code            Text
      explanation     Text
      created         UTCTime default=CURRENT_TIMESTAMP

      ownerR    Bool
      ownerW    Bool
      ownerX    Bool
      everyoneR Bool
      everyoneW Bool
      everyoneX Bool

      UniqueFile userId directoryId name
      deriving Show


------------------------------ Groups ------------------------------

Group
    name         Text
    owner        UserAccountId
    explanation  Text
    created      UTCTime default=CURRENT_TIMESTAMP

    UniqueGroup  name
    deriving Show

GroupMember
    groupId      GroupId
    member       UserAccountId
    created      UTCTime default=CURRENT_TIMESTAMP

    UniqueGroupMember groupId member
    deriving Show

DirectoryGroup
  directoryId   DirectoryId
  groupId       GroupId
  created       UTCTime default=CURRENT_TIMESTAMP

  groupR Bool
  groupW Bool
  groupX Bool

  UniqueDirectoryGroup  directoryId groupId
  deriving Show

FileGroup
  fileId     FileId
  groupId    GroupId
  created    UTCTime default=CURRENT_TIMESTAMP

  groupR Bool
  groupW Bool
  groupX Bool

  UniqueFileGroup fileId groupId
  deriving Show


----------------------------- Tags  ----------------------------
Tag
	name		Text
        created         UTCTime default=CURRENT_TIMESTAMP

	UniqueTag	name
	deriving Show

DirectoryTag
	directoryId	DirectoryId
	tagId		TagId
        created         UTCTime default=CURRENT_TIMESTAMP

	UniqueDirectoryTag directoryId tagId
	deriving Show

FileTag
	fileId	FileId
	tagId	TagId
        created UTCTime default=CURRENT_TIMESTAMP

	UniqueFileTag fileId tagId
        deriving Show


--------------------------  JSON Entities ----------------------------
FileJson json
      name            Text
      explanation     Text
      code            Text
      deriving Show

---------------------------- For testing  ----------------------------

Email
    email Text
    userId UserAccountId Maybe
    verkey Text Maybe

    UniqueEmail email

Comment json -- Adding "json" causes ToJSON and FromJSON instances to be derived.
    message Text
    userId UserAccountId Maybe
    deriving Eq
    deriving Show

 -- By default this file is used in Model.hs (which is imported by Foundation.hs)

Blog
    ownerId UserAccountId
    blogTitle  Text
    blogBody   Text
    deriving Show
